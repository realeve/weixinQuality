function jsRight(e,t){return e.substring(e.length-t,e.length)}function randomsort(e,t){return Math.random()>.5?-1:1}function getRandomArr(e,t){var a=[];"undefined"==typeof t&&(t=e,e=0);for(var i=e;i<t;i++)a.push(i);return a.sort(randomsort)}function timeReleasedTip(e){$.alert("答题时间到，系统将不再记录此后的得分，请提交当前成绩！","时间到！",function(){$.fn.fullpage.moveTo(0,e-2)})}function handleTotalScore(e,t,a){var i="";e>=80?i="感谢您的参与！":(a.loginData.iTimes<a.answerTimes&&(i="您还有一次答题机台，退出页面重新进入即可，下次继续努力哦！"),i="下次继续努力哦！"),$('[name="sucessInfo"] .weui_msg_desc').html('提交成功，您一共得了<span name="totalScore" style="font-weight:bold;color:#445"> '+e+" </span>分"),$(".weui_icon_msg").last().addClass("weui_icon_success").removeClass("weui_icon_warn"),$('[name="scoreLink"]').attr("href","./score.html?sid="+a.sportid+"&uid="+t),$('[name="errLink"]').attr("href","./error.html?sid="+a.sportid+"&uid="+t),$('[name="sucessInfo"] .weui_msg_title').text(i).show()}function submitPaper(e,t){$.ajax({url:"//cbpc540.applinzi.com/index.php?s=/addon/GoodVoice/GoodVoice/setSafeExamData",data:e,dataType:"jsonp",callback:"JsonCallback",success:function(a){0==a.status?$('[name="sucessInfo"] .weui_msg_title').text("提交失败，请稍后重试"):a.status==-1?$('[name="sucessInfo"] .weui_msg_title').text("该用户已提交数据"):(handleTotalScore(e.score,e.uid,t),t.realMatch||(e.score==t.loginData.oldScore?$.alert("本次得分"+e.score+"与上一次相同，系统将不保存此次得分","警告！"):e.score<t.loginData.oldScore&&$.alert("系统检测到本次得分"+e.score+"比上次更低，系统将不保存此次得分","警告！")))},error:function(e){var t="提交失败，请退出页面重新进入";$('[name="sucessInfo"] .weui_msg_title').text(t).show()}}).always(function(){t.isSubmit=!0,t.realMatch||$("#submit").hide()})}function isAllQuestionAnswered(e){for(var t=!0,a=e.isAnswered.length,i=0;i<a-1&&t;i++){var s=e.isAnswered[i];if(!s){var n=i+1;return e.realMatch||($.toast("第"+n+"题尚未作答，请先填写完所有题目再交卷"),$.fn.fullpage.moveTo(0,n+1)),t=!1}}return t}function today(e){var t,a=new Date,i=a.getFullYear(),s=jsRight("0"+(a.getMonth()+1),2),n=jsRight("0"+a.getDate(),2),r=a.getHours(),o=a.getMinutes(),l=a.getSeconds();switch(e){case 0:t=i+"年"+s+"月"+n+"日";break;case 1:t=i+"-"+s+"-"+n+" "+r+":"+o+":"+l;break;case 2:t=i+"年"+s+"月"+n+"日"+r+"时"+o+"分"+l+"秒";break;case 3:t=i+"-"+s+"-"+n+" "+r+":"+o;break;case 4:t=i+"年"+s+"月"+n+"日  "+r+"时"+o+"分";break;case 5:t=s+"/"+n+"/"+i;break;case 6:t=i+"-"+s+"-"+n}return t}function validate(e){var t=!0;return""==e.user_name?($('[name="userName"]').parents(".weui_cell").find("label").css("color","#fff"),t=!1):$('[name="userName"]').parents(".weui_cell").find("label").attr("style",""),""==e.user_dpt?($('[name="user_dpt"]').parents(".weui_cell").find("label").css("color","#fff"),t=!1):$('[name="user_dpt"]').parents(".weui_cell").find("label").attr("style",""),""==e.user_id?($('[name="userCard"]').parents(".weui_cell").find("label").css("color","#fff"),t=!1):$('[name="userCard"]').parents(".weui_cell").find("label").attr("style",""),t}function submitData(e,t,a){if(a.error=[],a.total=0,t=t+1<a.maxAnswerNum?t+1:a.maxAnswerNum,a.answerList.map(function(e,t){a.total+=e,e||a.error.push(a.sourceList[t])}),e&&!isAllQuestionAnswered(a)&&!a.realMatch)return a;var i="";a.error.map(function(e){i+=e+","}),i=i.length?i.substring(0,i.length-1):"-1";var s={score:(a.total*a.scoresPerAnswer).toFixed(0),errors:i,rec_time:today(1),start_time:a.loginData.loginTime,uid:a.loginData.uid,iTimes:a.loginData.iTimes,oldScore:a.loginData.oldScore,sportid:a.sportid,bCheck:e,answer_nums:t};return!e&&s.answer_nums<a.maxAnswerNum&&(s.iTimes=2),0==a.timeLength?$.modal({title:"提示",text:"您确定要交卷吗?",buttons:[{text:"交卷",onClick:function(){a.isSubmit=!0,submitPaper(s,a)}},{text:"检查一遍",onClick:function(){$.fn.fullpage.moveTo(0,2)}}]}):(a.isSubmit=!0,submitPaper(s,a)),a}module.exports={timeReleasedTip:timeReleasedTip,judgeTimeReleased:function(e){if(e.timeLength&&e.isLogin&&!e.isStarted&&!e.timeReleased){e.isStarted=!0,setTimeout(function(){e.timeReleased=!0,timeReleasedTip(e.lastPage)},e.timeLength);var t=e.timeLength/1e3/3,a=Math.floor(t/60)+"分"+(t%60>0?t%60+"秒":"钟");setTimeout(function(){$.toast("考试时间已过去"+a)},.33*e.timeLength),setTimeout(function(){$.toast("考试时间仅剩"+a+",请抓紧时间")},.67*e.timeLength)}return e},pageChange:function(e,t,a,i){var s=e-1;if(!i.debug){if("right"==a&&!i.isLogin&&!i.timeReleased)return void setTimeout(function(){$.fn.fullpage.moveTo(0,1)},200);"right"==a&&!i.timeReleased&&s>0&&s<i.lastPage-2&&!i.isAnswered[s-1]&&$.alert("第"+s+"题您还没有作答！","警告！",function(){$.fn.fullpage.moveTo(0,e)})}if(e>i.lastPage&&"right"==a&&$(".iSlider-arrow-blue-right").hide(),"left"==a&&i.isStarted&&i.isAnswered[s-2])return void(i.editAnswer||setTimeout(function(){$.fn.fullpage.moveTo(0,e),$.toast("不允许修改答案")},200))},handleTotalScore:handleTotalScore,today:today,getExamTemplate:function(e,t,a){var i=[],s=[];s=getRandomArr(e.question.length);var n=[];s.map(function(e,t){n[e]=t});var r='<div class="slide"><h1 class="answer-num title-hor blue-font">第<span>'+t+'</span>题</h1><div class="weui_cells_title blue-font" style="margin-top:-5px;line-height:1.2;">'+e.title+'</div><div class="weui_cells weui_cells_checkbox weui_cells_dark weui_cells_dark_myerr blue-font" data-id='+(t-6+5*a)+" data-order="+(t-1)+" data-answer="+(n[e.answer-1]+1)+">";e.question.map(function(e,a){i[a]="",i[a]+='    <label class="weui_cell weui_check_label" style="padding-top:5px;padding-bottom:5px;"><div class="weui_cell_hd">    <input type="radio" class="weui_check" name="radio'+(t-1)+'">    <i class="weui_icon_checked"></i></div><div class="weui_cell_bd weui_cell_primary" data-value='+n[a]+">    <p>"+e+"</p></div></label>"});for(var o="",l=0;l<e.question.length;l++)o+=i[s[l]];return r+=o+'</div><img name="fixed" src="//cbpc540.applinzi.com/topic/exam/assets/img/main.jpg" class="background_dark answer-title"></div>'},getRandomArr:getRandomArr,isAllQuestionAnswered:isAllQuestionAnswered,submitData:submitData,handleTouchEvent:function(e,t){var a=t.parents(".weui_cells"),i=t.parent().find(".weui_cell_primary"),s=i.data("value")+1==a.data("answer")?1:0,n=a.data("id");return e.answerList[n]=s,e.isAnswered[n]=1,e.curID=n,e.timeReleased?timeReleasedTip(e.lastPage):n<=e.maxAnswerNum-1&&(e.realMatch&&(e=submitData(!1,n,e)),setTimeout(function(){$.fn.fullpage.moveTo(0,n+3)},300)),e},getUserInfo:function(e){var t={user_name:$('[name="userName"]').val().trim(),user_id:$('[name="userCard"]').val().trim(),user_dpt:$('[name="user_dpt"]').val(),sportid:e.sportid};return validate(t)?$.ajax({url:"//cbpc540.applinzi.com/index.php?s=/addon/GoodVoice/GoodVoice/examSafeLogin",data:t,dataType:"jsonp",callback:"JsonCallback",success:function(a){0==a.id?$.alert("登录失败，请检查您的个人信息","警告！"):(localStorage.setItem("userInfo",JSON.stringify(t)),e.answerTimes>0&&a.answer_times>=e.answerTimes?$.alert("您已用完"+e.answerTimes+"次答题机会","警告！",function(){window.location.href="./score.html?sid="+e.sportid+"&uid="+a.id}):(e.isLogin=!0,e.loginData=t,e.loginData.uid=a.id,e.loginData.iTimes=Number.parseInt(a.answer_times)+1,e.loginData.oldScore=e.loginData.iTimes>=1?Number.parseInt(a.score):0,e.loginData.loginTime=today(1),e.loginData.iTimes>1?$.modal({title:"提示",text:"您已经提交过答案，是否继续作答?",buttons:[{text:"再做一遍",onClick:function(){$(this).parents(".slide").hide(),$.fn.fullpage.moveSlideRight()}},{text:"查看成绩",onClick:function(){window.location.href="./score.html?sid="+e.sportid+"&uid="+a.id}}]}):($(this).parents(".slide").hide(),$.fn.fullpage.moveSlideRight())))},error:function(e){$.alert("登录失败，请刷新重试","警告！")}}):$.toast("请输入个人用户信息","cancel"),e},afterSliderRender:function(e){if(!e.loadComplete){$("#fakeLoader").hide(),e.loadComplete=!0;var t=localStorage.getItem("userInfo");if(null!=t){var a=$.parseJSON(t);$('[name="user_dpt"]').val(a.user_dpt),$('[name="userName"]').val(a.user_name),$('[name="userCard"]').val(a.user_id)}}return e}};